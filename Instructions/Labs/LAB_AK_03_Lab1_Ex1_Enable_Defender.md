# 모듈 3 - 랩 1 - 연습 1 - Azure Defender를 사용하도록 설정

## 랩 시나리오

여러분은 Azure Defender를 사용하여 클라우드 워크로드 보호를 구현하고 있는 회사에서 일하는 보안 운영 분석자입니다.  이 랩에서는 Azure Defender를 사용하도록 설정합니다.

### 작업 1: Azure Portal에 액세스하여 구독 설정

이 연습에서는 이 랩과 이후 랩을 완료하는 데 필요한 Azure 구독을 설정합니다.

1. WIN1 가상 머신에 Admin으로 로그인합니다. 암호로는 **Pa55w.rd** 를 사용합니다.  

2. Microsoft Edge 브라우저를 엽니다.

3. Edge 브라우저에서 Azure Portal(https://portal.azure.com)로 이동합니다.

4. 랩 호스팅 공급자가 제공한 관리자 사용자 이름용 테넌트 전자 메일 계정을 복사하여 **로그인** 대화 상자에 붙여넣은 후 **다음**을 선택합니다.

5. 랩 호스팅 공급자가 제공한 관리자의 테넌트 암호를 복사하여 **암호 입력** 대화 상자에 붙여넣은 후 **로그인**을 선택합니다.

6. Azure Portal의 검색 창에 *구독*을 입력하고 **구독**을 선택합니다.

**중요:** 테넌트의 관리 사용자로 Azure 구독을 만들어야 합니다.

7. 강사가 제공한 "Azure Pass - 스폰서쉽"을 활용합니다.  이러한 랩은 강의 중에 USD $10 미만의 Azure 서비스를 사용하도록 설계되었습니다.

**참고:** 구독을 사용할 수 있게 될 때까지 최대 10분이 걸릴 수 있습니다. 

### 작업 2: Log Analytics 작업 영역 만들기

이 작업에서는 Azure Defender에서 사용할 Log Analytics 작업 영역을 만듭니다.

1. Azure Portal의 검색 창에 *Log Analytics*를 입력하고 **Log Analytics 작업 영역**을 선택합니다.

2. 명령 모음에서 **+ 만들기**를 선택합니다.

3. 리소스 그룹의 **새로 만들기**를 선택합니다.

4. *rg-AzureDefender* 를 입력합니다.

5. *uniquenameAzureDefender*와 같은 이름을 입력합니다.

6. **검토 + 만들기** 를 선택합니다.

7. 작업 영역 유효성 검사에 통과하면 **만들기**를 선택합니다. 새 작업 영역이 프로비전될 때까지 기다립니다. 몇 분 정도 걸릴 수 있습니다.

### 작업 3: Azure Defender를 사용하도록 설정

이 작업에서는 Azure Defender를 사용하도록 설정하고 구성합니다.

1. Azure Portal의 검색 창에 *보안*을 입력하고 **보안 센터**를 선택합니다.

2. 보안 센터의 **시작** 페이지에서 **업그레이드** 섹션으로 이동하여 구독이 선택되어 있는지 확인하고 **업그레이드** 단추를 선택합니다.

3. 구독에 이미 포함되어 있는 가상 머신에 에이전트를 설치하는 옵션이 다음 페이지에 표시됩니다. 여기서는 아무 작업도 수행하지 않습니다.

4. 포털 메뉴의 관리 영역에서 **가격 책정 및 설정**을 선택합니다.

5. "Azure Defender 플랜"이 "켜기"인지 확인합니다.  사용자의 구독을 선택합니다. 

6. 리소스와 요금을 검토합니다.

7. 설정 영역에서 **자동 프로비전**을 선택합니다.

8. 자동 프로비전 - 확장을 검토합니다. **Azure VM용 Log Analytics 에이전트**가 **꺼짐**으로 설정되어 있는지 확인합니다.

9. 보안 센터 포털로 돌아와서 **가격 책정 및 설정**을 다시 선택합니다.

10. 이전 *uniquenameAzureDefender*에서 만든 작업 영역 ID를 선택하여 가격 책정을 검토합니다.

### 작업 4: 온-프레미스 서버에 Azure Arc 설치

온-프레미스 서버에 Azure Arc를 설치하면 온-프레미스 서버를 더 쉽게 온보딩할 수 있습니다.  Azure Arc를 설치하면 Azure에서 온-프레미스 서버를 관리할 수 있도록 설정됩니다.

이 작업에서는 온-프레미스 서버에 Azure Arc를 설치합니다.

1. WINServer 가상 머신에 Administrator로 로그인합니다. 암호로는 **Passw0rd!** 를 사용합니다.  

2. Edge 브라우저에서 Azure Portal https://portal.azure.com 으로 이동합니다.

3. 랩 호스팅 공급자가 제공한 **테넌트 전자 메일** 계정을 복사하여 **로그인** 대화 상자에 붙여넣은 후 **다음**을 선택합니다.

4. 랩 호스팅 공급자가 제공한 **테넌트 암호**를 복사하여 **암호 입력** 대화 상자에 붙여넣은 후 **로그인**을 선택합니다.

5. Azure Portal의 검색 창에 *Arc*를 입력하고 **Azure Arc**를 선택합니다.

6. 탐색 창의 **인프라**에서 **서버**를 선택합니다.

7. **+ 추가**를 선택합니다.

8. "단일 서버 추가" 섹션에서 **스크립트 생성**을 선택합니다.

9. **다음**을 선택하여 리소스 세부 정보 탭으로 이동합니다.

10. 앞에서 만든 리소스 그룹을 선택합니다. 힌트: *rg-AzureDefender*

**참고** 리소스 그룹을 아직 만들지 않았으면 다른 탭을 열어서 리소스 그룹을 만듭니다.

11. **다음**을 선택하여 태그 탭으로 이동합니다.

12. **다음**을 선택하여 스크립트 다운로드 및 실행 탭으로 이동합니다.

13. **등록**을 선택합니다.

**참고** 처리가 완료되도록 3분 동안 기다립니다.

14. **다운로드** 단추를 선택합니다. 힌트: 브라우저에서 다운로드를 차단하는 경우 브라우저에서 다운로드를 허용하도록 설정합니다. Edge 브라우저에서 점 3개 "..."를 선택하고 "유지"를 선택합니다.

15. Windows PowerShell을 열고 **관리자 권한으로 실행**을 선택합니다.

16. 사용자 이름을 입력하라는 메시지가 표시되면 Administrator를 입력합니다.

17. 암호를 입력하라는 메시지가 표시되면 Passw0rd!를 입력합니다.

18. cd C:\Users\Administrator\Downloads를 입력합니다.

19. *Set-ExecutionPolicy - ExecutionPolicy Unrestricted* 를 입력하고 Enter 키를 누릅니다.

20. 모두 예에 해당하는 **A** 키를 누른 다음 Enter 키를 누릅니다.

21. *OnboardingScript.ps1* 을 입력하고 Enter 키를 누릅니다.

22. **R** 키를 눌러 한 번 실행하고 Enter 키를 누릅니다(몇 분 정도 걸릴 수 있음).

23. PowerShell 출력 마지막 줄에 있는 지침을 따라 디바이스 등록을 완료합니다.  여기에는 브라우저를 통한 디바이스 인증이 포함됩니다.  (https://microsoft.com/devicelogin) 브라우저 프롬프트를 찾아서 코드를 입력하여 인증합니다.

24. Azure Portal 페이지에서 **닫기**를 선택하고 **Azure Arc를 통해 서버 추가**를 닫습니다. Azure Arc 페이지에서 **서버**를 선택합니다.

25. WINServer 서버 이름이 표시될 때까지 **새로 고침**을 선택합니다.

**참고** 서버 이름이 표시되려면 몇 분 정도 걸릴 수 있습니다.

### 작업 5: 온-프레미스 서버 보호

이 작업에서는 Windows Server에 필요한 에이전트를 수동으로 설치합니다.

1. Azure Security Center로 이동하여 **시작** 페이지를 선택합니다.

2. **시작** 탭을 선택합니다.

3. *비 Azure 서버 추가* 섹션에서 **구성**을 선택합니다.

4. 앞에서 만든 작업 영역 옆의 **업그레이드**를 선택합니다.  이 작업은 몇 분 정도 걸릴 수 있습니다.  

5. 앞에서 만든 작업 영역 옆의 **+ 서버 추가**를 선택합니다.

6. **Windows 에이전트 다운로드(64비트)** 를 선택합니다.

7. 다운로드한 파일을 실행합니다.

8. 에이전트 설치 옵션 마법사 페이지가 나타날 때까지 **다음**을 선택하고 **Azure Log Analytics(OMS)에 에이전트 연결**을 선택한 후 **다음**을 선택합니다.

9. Azure Portal에 표시된 작업 영역 ID와 기본 키를 복사하여 마법사 페이지의 각 필드에 붙여넣은 후에 **다음**을 선택합니다.

10. 설치를 계속 진행합니다. 완료되면 **마침**을 선택합니다.

11. 보안 센터 포털로 이동하여 **인벤토리**를 선택합니다.

12. 목록에 서버가 표시됩니다.  업데이트를 확인하려면 **새로 고침**을 선택해야 할 수 있습니다. 업데이트가 표시될 때까지 몇 분 정도 걸릴 수 있습니다.

13. 다음 랩으로 진행하고 나중에 **보안 센터**로 돌아올 수 있습니다. 서버가 **인벤토리** 섹션에 표시됩니다. 


# 연습 2 계속 진행
