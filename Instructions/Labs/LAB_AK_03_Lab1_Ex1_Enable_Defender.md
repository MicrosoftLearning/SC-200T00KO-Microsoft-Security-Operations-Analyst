# 모듈 3 - 랩 1 - 연습 1 - Azure Defender를 사용하도록 설정

## 랩 시나리오

여러분은 Azure Defender를 사용하여 클라우드 워크로드 보호를 구현하고 있는 회사에서 일하는 보안 운영 분석자입니다.  이 랩에서는 Azure Defender를 사용하도록 설정합니다.

### 작업 1: Azure Portal에 액세스하여 구독 설정

이 연습에서는 이 랩과 이후 랩을 완료하는 데 필요한 Azure 구독을 설정합니다.

1. WIN1 가상 머신에 Admin으로 로그인합니다. 암호로는 **Pa55w.rd** 를 사용합니다.  

2.  이전 랩에서 이 과정을 진행하지 않았다면 브라우저를 열고 Microsoft Edge 브라우저를 검색하여 다운로드한 후 새로 설치합니다. 새 Edge 브라우저를 시작합니다.

3.  Edge 브라우저에서 Azure Portal https://portal.azure.com 으로 이동합니다.

4. 랩 호스팅 공급자가 제공한 관리자 사용자 이름용 테넌트 전자 메일 계정을 복사하여 **로그인** 대화 상자에 붙여넣은 후 **다음**을 선택합니다.

5. 랩 호스팅 공급자가 제공한 관리자의 테넌트 암호를 복사하여 **암호 입력** 대화 상자에 붙여넣은 후 **로그인**을 선택합니다.

6. Azure Portal의 검색 창에 *구독*을 입력하고 **구독**을 선택합니다.

**중요:** 테넌트의 관리 사용자로 Azure 구독을 만들어야 합니다.

7. 새 구독에서 **추가**를 선택합니다.

8. 해당 페이지의 지침에 따라 적절한 새 구독을 만듭니다.  대부분의 경우에는 "무료 평가판"을 선택하면 됩니다.

**참고:** 구독을 사용할 수 있게 될 때까지 최대 30분이 걸릴 수 있습니다. 

### 작업 2: Log Analytics 작업 영역 만들기

이 작업에서는 Azure Defender에서 사용할 Log Analytics 작업 영역을 만듭니다.

1. Azure Portal의 검색 창에 *Log Analytics*를 입력하고 **Log Analytics 작업 영역**을 선택합니다.

2. 명령 모음에서 **+ 만들기**를 선택합니다.

3. 리소스 그룹의 **새로 만들기**를 선택합니다.

4. *rg-AzureDefender* 를 입력합니다.

5. 이름으로는 *uniquename_AzureDefender* 와 같은 고유한 이름을 입력합니다.

6. **검토 + 만들기** 를 선택합니다.

7. 작업 영역 유효성 검사에 통과하면 **만들기**를 선택합니다.

**참고:** 새 작업 영역이 프로비전될 때까지 기다립니다. 몇 분 정도 걸릴 수 있습니다.

### 작업 3: Azure Defender를 사용하도록 설정

이 작업에서는 Azure Defender를 사용하도록 설정하고 구성합니다.

1. Azure Portal의 검색 창에 *보안*을 입력하고 **보안 센터**를 선택합니다.

2. 보안 센터의 **시작** 페이지에서 **업그레이드** 섹션으로 이동하여 구독이 선택되어 있는지 확인하고 **업그레이드** 단추를 선택합니다.

3. 구독에 이미 포함되어 있는 가상 머신에 에이전트를 설치하는 옵션이 다음 페이지에 표시됩니다. 여기서는 아무 작업도 수행하지 않습니다.

4. 포털 메뉴의 관리 영역에서 **가격 책정 및 설정**을 선택합니다.

5. 사용자의 구독을 선택합니다. 

6. 리소스와 요금을 검토합니다.  서버 **끄기**를 선택하고 **저장**을 선택합니다.  메시지가 표시되면 서버 끄기를 확인합니다.

**참고:** 이 단계는 랩 진행용으로만 수행하는 작업입니다.  자동으로 보호되는 리소스 및 관련 요금을 파악해 두면 유용하기 때문입니다.  다음 단계에서는 Azure 구독의 비용을 관리하기 위해  서버용 Azure Defender를 사용하지 않도록 설정합니다. 일반적으로는 서버용 Azure Defender를 사용하도록 설정한 상태로 유지해야 합니다.

7. 설정 영역에서 **자동 프로비전**을 선택합니다.

8. 자동 프로비전 - 확장을 검토합니다. **Azure VM용 Log Analytics 에이전트**가 **꺼짐**으로 설정되어 있는지 확인합니다.

9. 보안 센터 포털로 돌아와서 **가격 책정 및 설정**을 다시 선택합니다.

10. 앞에서 만든 작업 영역 ID인 **uniquename_AzureDefender** 를 선택합니다.

11. 서버 요금제가 아직 꺼져 있지 않으면 서버 **끄기**를 선택하고 **저장**을 선택합니다.


### 작업 4: 온-프레미스 서버에 Azure Arc 설치

온-프레미스 서버에 Azure Arc를 설치하면 온-프레미스 서버를 더 쉽게 온보딩할 수 있습니다.  Azure Arc를 설치하면 Azure에서 온-프레미스 서버를 관리할 수 있도록 설정됩니다.

이 작업에서는 온-프레미스 서버에 Azure Arc를 설치합니다.

1. WINServer 가상 머신에 Administrator로 로그인합니다. 암호로는 **Passw0rd!** 를 사용합니다.  

2. Edge 브라우저에서 Azure Portal https://portal.azure.com 으로 이동합니다.

3. 랩 호스팅 공급자가 제공한 **테넌트 전자 메일** 계정을 복사하여 **로그인** 대화 상자에 붙여넣은 후 **다음**을 선택합니다.

4. 랩 호스팅 공급자가 제공한 **테넌트 암호**를 복사하여 **암호 입력** 대화 상자에 붙여넣은 후 **로그인**을 선택합니다.

5. Azure Portal의 검색 창에 *Azure Arc*를 입력하고 **Azure Arc**를 선택합니다.

6. Azure Arc 페이지 메뉴에서 **서버**를 선택합니다.

7. **+ 추가**를 선택합니다.

8. 단일 서버 추가 섹션에서 **스크립트 생성**을 선택합니다.

9. **다음: 리소스 세부 정보 >** 를 선택합니다.

10. 앞에서 만든 리소스 그룹을 선택합니다. 힌트: *rg-AzureDefender*

**참고** 리소스 그룹을 아직 만들지 않았으면 다른 탭을 열어서 리소스 그룹을 만듭니다.

11. **다음: 태그 >** 를 선택합니다.

12. **다음: 스크립트 다운로드 및 실행 >** 을 선택합니다.

13. **등록**을 선택합니다.

**참고** 처리가 완료되도록 3분 동안 기다립니다.

14. **다운로드** 단추를 선택합니다. 

15. Windows PowerShell을 열고 **관리자 권한으로 실행**을 선택합니다.

16. 사용자 이름을 입력하라는 메시지가 표시되면 Administrator를 입력합니다.

17. 암호를 입력하라는 메시지가 표시되면 Passw0rd!를 입력합니다.

18. cd Downloads를 입력합니다.
화면에 다음 프롬프트가 표시됩니다.
PS C:\Users\Administrators\Downloads

19. *Set-ExecutionPolicy - ExecutionPolicy Unrestricted* 를 입력하고 Enter 키를 누릅니다.

20. 모두 예에 해당하는 **A** 키를 누른 다음 Enter 키를 누릅니다.

21. *OnboardingScript.ps1* 을 입력하고 Enter 키를 누릅니다.

22. 한 번 실행에 해당하는 **R** 키를 누르고 Enter 키를 누릅니다(스크립트가 실행되려면 1분 정도 걸릴 수 있음).

23. 화면의 지시에 따라 디바이스 등록을 완료합니다.  등록 과정에서 디바이스 인증도 진행됩니다.

24. Azure Arc 포털 페이지에서 **서버**를 선택합니다.

25. 서버 이름이 표시될 때까지 **새로 고침**을 선택합니다.

**참고** 서버 이름이 표시되려면 몇 분 정도 걸릴 수 있습니다.

### 작업 5: 온-프레미스 서버 보호

이 작업에서는 Windows Server에 필요한 에이전트를 수동으로 설치합니다.

1. Azure Security Center로 이동하여 **시작** 페이지를 선택합니다.

2. **시작** 탭을 선택합니다.

3. Azure 외 서버 추가 섹션에서 **구성**을 선택합니다.

4. 앞에서 만든 작업 영역 옆의 **업그레이드**를 선택합니다.  힌트: uniqueAzureDefender 

5. 앞에서 만든 작업 영역 옆의 **+ 서버 추가**를 선택합니다.

6. **Windows 에이전트 다운로드(64비트)** 를 선택합니다.

7. 다운로드한 파일을 실행합니다.

8. 마법사의 에이전트 설치 옵션 페이지가 표시될 때까지 **다음**을 선택하고 **Log Analytics(OMS)에 에이전트 연결**을 선택한 후 **다음**을 선택합니다.

9. Azure Portal에 표시된 작업 영역 ID와 기본 키를 복사하여 마법사 페이지의 각 필드에 붙여넣은 후에 **다음**을 선택합니다.

10. 설치를 계속 진행합니다. 그런 다음 설치가 완료되면 **마침**을 선택합니다.

11. 보안 센터 포털로 이동하여 **인벤토리**를 선택합니다.

12. 목록에 서버가 표시됩니다.  업데이트를 확인하려면 **새로 고침**을 선택해야 할 수 있습니다. 업데이트가 표시될 때까지 몇 분 정도 걸릴 수 있습니다.

**참고** 서버는 보호되지 않은 상태로 표시됩니다.  앞에서 서버용 Azure Defender 요금제를 껐으므로 이렇게 표시되는 것은 정상적인 현상입니다. 

# 연습 2 계속 진행